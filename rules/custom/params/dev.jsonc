{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    // Development environment overrides
    // Lower severity for testing, more frequent queries for validation
    "ruleName": {
      "value": "[ORG] – Suspicious PowerShell (EncodedCommand) [DEV]"
    },
    "severity": {
      "value": "Low"
    },
    "enabled": {
      "value": true
    },
    "query": {
      "value": "SecurityEvent\n| where EventID == 4104\n| where EventData contains \"EncodedCommand\"\n| where EventData contains \"powershell\"\n| extend EncodedCommand = extract(\"EncodedCommand\\\\s*=\\\\s*([^\\\\s]+)\", 1, EventData)\n| where isnotempty(EncodedCommand)\n| extend DecodedCommand = base64_decode_tostring(EncodedCommand)\n| where DecodedCommand contains \"Invoke-Expression\" or DecodedCommand contains \"IEX\"\n| project TimeGenerated, Computer, SubjectUserName, EncodedCommand, DecodedCommand\n| take 100"
    },
    "tactics": {
      "value": [
        "Execution",
        "DefenseEvasion"
      ]
    },
    "techniques": {
      "value": [
        "T1059.001"
      ]
    },
    "createIncident": {
      "value": false
    },
    "groupAlerts": {
      "value": false
    },
    "groupingMethod": {
      "value": "SingleAlert"
    },
    "groupByFields": {
      "value": ""
    },

    // New rule: Suspicious Login Attempts
    "ruleDisplayName": {
      "value": "[ORG] – Suspicious Login Attempts (T1078) [DEV]"
    },
    "ruleSeverity": {
      "value": "Low"
    },
    "ruleEnabled": {
      "value": true
    },
    "failedLoginThreshold": {
      "value": 3
    },
    "queryFrequency": {
      "value": "PT15M"
    },
    "queryPeriod": {
      "value": "PT15M"
    },
    "createIncident": {
      "value": false
    },
    "groupAlerts": {
      "value": false
    },
    "groupingMethod": {
      "value": "SingleAlert"
    },
    "groupByFields": {
      "value": ""
    },

    // New rule: Admin Account Anomaly Detection
    "ruleDisplayName": {
      "value": "[ORG] – Admin Account Anomaly Detection (T1078) [DEV]"
    },
    "ruleSeverity": {
      "value": "Medium"
    },
    "ruleEnabled": {
      "value": true
    },
    "adminLoginThreshold": {
      "value": 2
    },
    "queryFrequency": {
      "value": "PT30M"
    },
    "queryPeriod": {
      "value": "PT30M"
    },
    "createIncident": {
      "value": false
    },
    "groupAlerts": {
      "value": false
    },
    "groupingMethod": {
      "value": "SingleAlert"
    },
    "groupByFields": {
      "value": ""
    }
  }
}
